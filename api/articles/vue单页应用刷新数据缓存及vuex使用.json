{"title":"'vue单页应用刷新数据缓存及vuex使用'","slug":"vue单页应用刷新数据缓存及vuex使用","date":"2019-03-12T02:34:49.000Z","updated":"2019-04-23T07:55:20.584Z","comments":true,"excerpt":"","content":"<p>利用 vue 框架做 PC 端应用时，刷新当前页面如何缓存当前页面数据，如果单纯利用 localStorage，在每次改变数据的时候都需要触发 localStorage.setItem 方法，对性能不友好。而且 vue 提供了 Vuex 这种更方便的状态管理工具。在查阅别人的方案后，得到了较好的解决方法————监听刷新事件，在刷新时将 vuex 里的内容保存到 localStorage 中。（借鉴：<a href=\"https://blog.csdn.net/aliven1/article/details/80743470）\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/aliven1/article/details/80743470）</a><br>vuex 的官方文档已经描述的很详细了，在此只记录下如何使用 vuex 及如何做刷新缓存，加深印象。</p>\n<p>一、vuex 的使用<br>1、结构示例</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">store</span><br><span class=\"line\">    ├── index.js          <span class=\"comment\"># 我们组装模块并导出 store 的地方</span></span><br><span class=\"line\">    ├── state.js          <span class=\"comment\"># state 单一状态树</span></span><br><span class=\"line\">    └── mutations.js      <span class=\"comment\"># 根级别的 mutation</span></span><br></pre></td></tr></table></figure>\n<p>2、代码</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//index</span><br><span class=\"line\">import Vue from <span class=\"string\">'vue'</span></span><br><span class=\"line\">import Vuex from <span class=\"string\">'vuex'</span></span><br><span class=\"line\">import state from <span class=\"string\">'./state'</span></span><br><span class=\"line\">import mutations from <span class=\"string\">'./mutations'</span></span><br><span class=\"line\"></span><br><span class=\"line\">Vue.use(Vuex)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">export</span> default new Vuex.Store(&#123;</span><br><span class=\"line\">  state,</span><br><span class=\"line\">  mutations</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">//state</span><br><span class=\"line\"><span class=\"built_in\">let</span> mwSolutionInfos = [&#123;</span><br><span class=\"line\">  <span class=\"string\">'name'</span>: <span class=\"string\">'名称'</span>,</span><br><span class=\"line\">  <span class=\"string\">'mw_suggest_cards'</span>: [&#123;</span><br><span class=\"line\">    <span class=\"string\">'name'</span>: <span class=\"string\">'方案卡'</span>,</span><br><span class=\"line\">    <span class=\"string\">'mw_suggest_products'</span>: [],</span><br><span class=\"line\">    <span class=\"string\">'mw_suggest_techs'</span>: [],</span><br><span class=\"line\">    <span class=\"string\">'mw_suggest_exps'</span>: [],</span><br><span class=\"line\">    <span class=\"string\">'id'</span>: <span class=\"string\">'1'</span></span><br><span class=\"line\">  &#125;]</span><br><span class=\"line\">&#125;]</span><br><span class=\"line\">try &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (localStorage.solution) &#123;</span><br><span class=\"line\">    mwSolutionInfos = localStorage.solution</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; catch (error) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">export</span> default &#123;</span><br><span class=\"line\">  solution: mwSolutionInfos</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//mulations</span><br><span class=\"line\"><span class=\"built_in\">export</span> default &#123;</span><br><span class=\"line\">  replaceState (state, solution) &#123;</span><br><span class=\"line\">    state.solution = solution</span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">      localStorage.solution = solution</span><br><span class=\"line\">    &#125; catch (error) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在 vue 中存取数据</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; mapState, mapMutations &#125; from <span class=\"string\">'vuex'</span></span><br><span class=\"line\">methods: &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">function</span></span> () &#123;</span><br><span class=\"line\">      this.replaceState(this.mw_solution_infos)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    ...mapMutations([<span class=\"string\">'replaceState'</span>])</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//利用双向绑定的计算属性取出数据渲染</span><br><span class=\"line\">computed: &#123;</span><br><span class=\"line\">    ...mapState([<span class=\"string\">'solution'</span>])</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>二、刷新当前页面缓存当前页面数据<br>利用 beforeunload 监听事件监听页面刷新</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">created</span></span> () &#123;</span><br><span class=\"line\">    localStorage.getItem(<span class=\"string\">'solution'</span>) &amp;&amp; this.<span class=\"variable\">$store</span>.replaceState(Object.assign(this.<span class=\"variable\">$store</span>.state, JSON.parse(localStorage.getItem(<span class=\"string\">'solution'</span>))))</span><br><span class=\"line\"></span><br><span class=\"line\">    window.addEventListener(<span class=\"string\">'beforeunload'</span>, () =&gt; &#123;</span><br><span class=\"line\">      localStorage.setItem(<span class=\"string\">'solution'</span>, JSON.stringify(this.<span class=\"variable\">$store</span>.state))</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n","categories":[],"tags":[]}