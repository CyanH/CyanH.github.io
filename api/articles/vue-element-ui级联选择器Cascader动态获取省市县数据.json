{"title":"vue + element-ui级联选择器Cascader动态获取省市区数据","slug":"vue-element-ui级联选择器Cascader动态获取省市县数据","date":"2019-04-23T07:33:48.000Z","updated":"2019-04-23T07:44:54.531Z","comments":true,"excerpt":"","content":"<p>在做项目时，有要求要传省市区对应的 id，因此省市区数据只能动态从后台获取。思路是通过点击父级往数据上添加 children 元素。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># HTML</span></span><br><span class=\"line\"> &lt;el-cascader</span><br><span class=\"line\">    :options=<span class=\"string\">\"provenceArray\"</span></span><br><span class=\"line\">    v-model=<span class=\"string\">\"area_id\"</span></span><br><span class=\"line\">    @active-item-change=<span class=\"string\">\"handleItemChange\"</span></span><br><span class=\"line\">    :props=<span class=\"string\">\"props\"</span></span><br><span class=\"line\">&gt;&lt;/el-cascader&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># JS</span></span><br><span class=\"line\">  data: <span class=\"function\"><span class=\"title\">function</span></span> () &#123;</span><br><span class=\"line\">    <span class=\"built_in\">return</span> &#123;</span><br><span class=\"line\">      provenceArray: [],</span><br><span class=\"line\">      area_id,</span><br><span class=\"line\">      props: &#123;</span><br><span class=\"line\">        label: <span class=\"string\">'name'</span>,</span><br><span class=\"line\">        value: <span class=\"string\">'id'</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">getProvenceData</span></span> () &#123;</span><br><span class=\"line\">      getProvence().<span class=\"keyword\">then</span>(res =&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (res.code === 200) &#123;</span><br><span class=\"line\">          this.provenceArray = res.data</span><br><span class=\"line\">          this.provenceArray.forEach((item, index) =&gt; &#123;</span><br><span class=\"line\">            this.<span class=\"variable\">$set</span>(this.provenceArray[index], <span class=\"string\">'children'</span>, [])</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    handleItemChange (val) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">let</span> length = val.length</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (length === 1) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">let</span> bs_area_parent_id = val[0]</span><br><span class=\"line\">        //封装的请求</span><br><span class=\"line\">        getArea(&#123; bs_area_parent_id &#125;).<span class=\"keyword\">then</span>(res =&gt; &#123;</span><br><span class=\"line\">          <span class=\"built_in\">let</span> area = res.data</span><br><span class=\"line\">          this.provenceArray.map((item, index) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (item.id === bs_area_parent_id) &#123;</span><br><span class=\"line\">              area.forEach((v, i) =&gt; &#123;</span><br><span class=\"line\">                this.<span class=\"variable\">$set</span>(area[i], <span class=\"string\">'children'</span>, [])</span><br><span class=\"line\">              &#125;)</span><br><span class=\"line\">              this.<span class=\"variable\">$set</span>(this.provenceArray[index], <span class=\"string\">'children'</span>, area)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (length === 2) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">let</span> bs_area_parent_id = val[1]</span><br><span class=\"line\">        //封装的请求</span><br><span class=\"line\">        getArea(&#123; bs_area_parent_id &#125;).<span class=\"keyword\">then</span>(res =&gt; &#123;</span><br><span class=\"line\">          <span class=\"built_in\">let</span> area = res.data</span><br><span class=\"line\">          this.provenceArray.map((item, index) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (item.id === val[0]) &#123;</span><br><span class=\"line\">              item.children.map((v, i) =&gt; &#123;</span><br><span class=\"line\">                this.<span class=\"variable\">$set</span>(this.provenceArray[index].children[i], <span class=\"string\">'children'</span>, area)</span><br><span class=\"line\">              &#125;)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>唯一的坑就是动态获取数据不能选择任意一级的选项<br><img src=\"/2019/04/23/vue-element-ui级联选择器Cascader动态获取省市县数据/1.png\" alt=\"map\"><br><img src=\"/2019/04/23/vue-element-ui级联选择器Cascader动态获取省市县数据/2.png\" alt=\"map\"></p>\n","categories":[],"tags":[]}